language: minimal

compiler:
    - g++
   
cache:
    ccache: true
    pip: true

before_install:
  - sudo apt-get update
  - sudo apt-get -y install python3-pip libhdf5-dev libhdf5-serial-dev
  - python3 --version
  - pip3 --version
  - sudo -H pip3 install --upgrade pip
  - sudo -H pip3 install setuptools
  - sudo -H pip3 install python-coveralls
  - sudo pip3 list --outdated --format=freeze | grep -v '^\-e' | cut -d = -f 1  | xargs -n1 sudo -H pip3 install -U
  - sudo -H pip3 install tensorflow
  - sudo -H pip3 install torch==1.3.1+cpu torchvision==0.4.2+cpu -f https://download.pytorch.org/whl/torch_stable.html

install:
    - sudo -H pip3 install -e . -r requirements.txt
    - df -h

script:
  - coverage run -m unittest discover

after_success:
  - codecov
  - coveralls